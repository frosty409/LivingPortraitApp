THat's
<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="author" content="Juan Melendrez (jdesign21)" />
  <title>Collapsible Sidebar</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter&family=Poppins&family=Roboto&display=swap"
    rel="stylesheet" />
  <link
    href="https://fonts.googleapis.com/css2?family=Creepster&family=Butcherman&family=Fredericka+the+Great&family=Nosifer&family=UnifrakturCook&family=UnifrakturMaguntia&display=swap"
    rel="stylesheet" />
  <style>
    .video-wrapper {
      width: 100%;
      max-width: 360px;
      height: 640px;
      overflow: hidden;
      margin-top: 1rem;
    }

    #videoPreview {
      width: 640px;
      height: 360px;
      transform: rotate(90deg) translate(0, -100%);
      transform-origin: top left;
      display: block;
      max-width: none;
    }

    #dropArea {
      cursor: pointer;
      transition: background-color 0.3s, border-color 0.3s;
    }

    #triggeredFlag {
      transform: scale(1.8);
    }
  </style>
  <style>
    body {
      overflow-x: hidden;
      background: #f0f0f0;
    }

    .sidebar {
      position: fixed;
      top: 0;
      left: 0;
      height: 100vh;
      background-color: #fff;
      color: #333;
      width: 220px;
      padding-top: 40px;
      transition: width 0.3s ease;
      overflow: hidden;
      box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
      z-index: 1040;
      display: flex;
      flex-direction: column;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      /* smooth scrolling on iOS */
      padding-bottom: 1rem;
      /* ensures last icon isn't clipped */
      overflow: hidden;
    }

    .sidebar.collapsed {
      width: 60px;
    }

    .sidebar .nav-link {
      color: #333;
      font-weight: 500;
      display: flex;
      align-items: center;
      padding: 12px 12px;
      white-space: nowrap;
      border-left: 4px solid transparent;
      transition: background-color 0.2s, border-color 0.2s;
      cursor: pointer;
      user-select: none;
    }

    .sidebar .nav-link:hover,
    .sidebar .nav-link.active {
      background-color: #e9ecef;
      border-left-color: #0d6efd;
      color: #0d6efd;
    }

    .sidebar .nav-link i {
      font-size: 1.25rem;
      margin-right: 12px;
      min-width: 24px;
      text-align: center;
    }

    .sidebar .nav-link span.label {
      flex: 1;
      transition: opacity 0.3s ease;
    }

    .sidebar.collapsed .nav-link span.label {
      opacity: 0;
      pointer-events: none;
    }

    .content {
      margin-left: 220px;
      padding: 20px;
      transition: margin-left 0.3s ease;
      min-height: 100vh;
      background: #f0f0f0;
      position: relative;
      z-index: 1;
    }

    .content::before {
      content: "";
      position: fixed;
      top: 0;
      left: 220px;
      width: 1px;
      height: 100vh;
      background-color: #ddd;
      box-shadow: 1px 0 5px rgba(0, 0, 0, 0.1);
      z-index: 1039;
      transition: left 0.3s ease;
    }

    .content.collapsed {
      margin-left: 60px;
    }

    .content.collapsed::before {
      left: 60px;
    }

    /* Toggle Button */
    #toggleSidebar {
      position: absolute;
      top: 10px;
      right: 10px;
      z-index: 1050;
      transition: transform 0.3s ease;
    }

    #toggleSidebar .bi {
      transition: transform 0.3s ease;
    }

    .sidebar.collapsed #toggleSidebar .bi {
      transform: rotate(180deg);
    }

    .section {
      display: none;
    }

    .section.active {
      display: block;
    }

    /* Mobile Behavior */
    @media (max-width: 767.98px) {
      .sidebar {
        width: 60px !important;
      }

      .sidebar .nav-link span.label {
        display: none !important;
      }

      .content {
        margin-left: 60px !important;
      }

      .content::before {
        left: 60px !important;
      }

      #toggleSidebar {
        display: none !important;
        /* hide arrow button on mobile */
      }
    }

    /* Dark Mode Overrides */
    body.dark-theme {
      background-color: #121212;
      color: #ffffff;
    }

    .dark-theme .card,
    .dark-theme .modal-content,
    .dark-theme .offcanvas,
    .dark-theme .form-control,
    .dark-theme .form-check-label,
    .dark-theme .list-group-item,
    .dark-theme #dropArea {
      background-color: #1e1e1e !important;
      color: #ffffff !important;
    }

    .dark-theme .btn-outline-secondary {
      color: #ffffff;
      border-color: #ffffff;
    }

    .dark-theme .btn-outline-secondary:hover {
      background-color: #ffffff;
      color: #000000;
    }

    .dark-theme .text-muted {
      color: #cccccc !important;
    }

    .dark-theme .form-check-input:checked {
      background-color: #0d6efd;
      border-color: #0d6efd;
    }

    #lightSwitch {
      transform: scale(1.8);
    }

    #pauseSystem {
      transform: scale(1.8);
    }

    /* Added dark mode sidebar */
    .dark-theme .sidebar {
      background-color: #1e1e1e;
      color: #ccc;
      box-shadow: 2px 0 5px rgba(255, 255, 255, 0.1);
    }

    .dark-theme .sidebar .nav-link {
      color: #ccc;
    }

    .dark-theme .sidebar .nav-link:hover,
    .dark-theme .sidebar .nav-link.active {
      background-color: #333;
      border-left-color: #0d6efd;
      color: #0d6efd;
    }

    /* Added dark mode content */
    .dark-theme .content {
      background: #121212;
      color: #eee;
    }

    .dark-theme .content::before {
      background-color: #333;
      box-shadow: 1px 0 5px rgba(255, 255, 255, 0.1);
    }

    /* Default logo size on desktop */
    .sidebar-logo-img {
      max-width: 100px;
      height: auto;
      transition: max-width 0.3s ease;
    }

    /* Smaller logo when sidebar is collapsed */
    .sidebar.collapsed .sidebar-logo-img {
      max-width: 40px;
    }

    /* Smaller on mobile screens too */
    @media (max-width: 767.98px) {
      .sidebar-logo-img {
        max-width: 40px;
      }
    }

    pre {
      white-space: pre-wrap;
      word-wrap: break-word;
      background-color: #f8f9fa;
      padding: 1rem;
      border-radius: 5px;
      max-height: 600px;
      overflow-y: auto;
      font-family: monospace;
    }


    .dark-theme pre {
  background-color: #1e1e1e;
  color: #e0e0e0;
  border: 1px solid #333;
}
  </style>
</head>

<body class="{{ 'dark-theme' if theme == 'dark' else '' }}">

  <nav class="sidebar" id="sidebar">

    <div class="sidebar-logo text-center">
      <img src="{{ url_for('image_file', filename='logo.png') }}" alt="Logo" class="sidebar-logo-img img-fluid">
    </div>


    <button id="toggleSidebar" class="btn btn-sm btn-light border">
      <i class="bi bi-chevron-left"></i>
    </button>

    <a class="nav-link active" data-section="home">
      <i class="bi bi-house"></i>
      <span class="label">Home</span>
    </a>

    <a class="nav-link" data-section="mode">
      <i class="bi bi-check-square"></i>
      <span class="label">Mode</span>
    </a>

    <a class="nav-link" data-section="schedule">
      <i class="bi bi-calendar-check"></i>
      <span class="label">Schedule</span>
    </a>

    <a class="nav-link" data-section="upload">
      <i class="bi bi-upload"></i>
      <span class="label">Upload</span>
    </a>
    <a class="nav-link" data-section="manage">
      <i class="bi bi-folder2-open"></i>
      <span class="label">Manage</span>
    </a>
    <a class="nav-link" data-section="logs">
      <i class="bi bi-file-earmark-text"></i>
      <span class="label">Logs</span>
    </a>


    <a class="nav-link" data-section="Appearance">
      <i class="bi bi-palette"></i>
      <span class="label">Appearance</span>
    </a>

    <a class="nav-link" data-section="about">
      <i class="bi  bi-info-circle"></i>
      <span class="label">About</span>
    </a>

  </nav>


  <main class="content" id="mainContent">


    <!-- Pause Message -->
    {% if pause %}
    <div class="alert alert-warning text-center">
      <strong>System is paused.</strong> No video will be switched or played during this time.
    </div>
    {% endif %}

    {% if not is_schedule_enabled_now %}
    <div class="alert alert-warning text-center">
      <strong>Playback is currently disabled by schedule.</strong>
      <br>Next active time: {{ next_start_time or 'unknown' }}
    </div>
    {% endif %}



    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    {% for category, message in messages %}
    <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
      {{ message }}
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% endfor %}
    {% endif %}
    {% endwith %}

    <section id="home" class="section active">
      <h3 class="fw-bold border-bottom pb-2 mb-4 text-primary">Home</h3>


      <!-- Playback Preview -->
      <div id="mainControls" class="container-fluid p-0"
        style="display: {{ 'none' if pause or not is_schedule_enabled_now else 'block' }}">
        <div class="card shadow-sm">
          <div class="card-header bg-primary text-white">
            <strong>
              {% if playlist_mode == 'random' %}
              Random Mode
              {% elif playlist_mode == 'fixed' and fixed_order %}
              Fixed Order Mode
              {% elif playlist_mode == 'single' %}
              Single Video
              {% endif %}
            </strong>
          </div>
          <div class="card-body">
            <p class="text-muted small mb-0">View the current video and playlist based on the selected playback mode.
            </p><br>

            
{% if today_schedule.enabled %}
<strong>Schedule for {{ today }}</strong>
  <p>Start Time: {{ today_schedule.start_ampm }} - End End: {{ today_schedule.end_ampm }}</p>
{% endif %}

            {% if triggered_flag %}
              <p>Triggered Mode: On</p>
              {% set minutes = delay // 60 %}
              {% set seconds = delay % 60 %}
              <p>Trigger Delay: {{ minutes }}m {{ seconds }}s</p>
            {% else %}
              <p>Triggered Mode: Off</p>
            {% endif %}
            
            {% if playlist_mode == 'random' %}
            <p>Current Video: <strong>{{ selected }}</strong></p>
            {% if time_remaining is not none %}
            <p>Next switch in: <span id="countdown">{{ time_remaining }}</span> seconds</p>
            {% endif %}
            {% elif playlist_mode == 'fixed' and fixed_order %}
            <p>Current Video: <strong>{{ selected }}</strong></p>
            {% if time_remaining is not none %}
            <p>Next switch in: <span id="countdown">{{ time_remaining }}</span> seconds</p>
            {% endif %}
            <p>Playlist:</p>
            <ol>
              {% for video in fixed_order %}
              <li>{{ video.filename }}</li>
              {% endfor %}
            </ol>
            {% elif playlist_mode == 'single' %}
            <p>Selected Video: <strong>{{ selected }}</strong></p>
            {% endif %}
          </div>
        </div>

        <br>
        <div class="card shadow-sm">
          <div class="card-header bg-primary text-white">
            <strong>Playback Preview</strong>
          </div>
          <div class="card-body">


            <!-- Card for video only -->
            <video id="videoPreview" controls autoplay muted class="w-100 mt-3" style="max-width:360px;">
              {% if selected %}
              <source src="{{ url_for('video_file', filename=selected) }}" type="video/mp4" />
              {% endif %}
              Your browser does not support the video tag.
            </video>
          </div>
        </div>
      </div>

    </section>

    <section id="mode" class="section">


      <h3 class="fw-bold border-bottom pb-2 mb-4 text-primary">Mode</h3>
      <!-- Pause Toggle -->

      <div class="card mb-4 shadow-sm">
        <div class="card-header bg-primary text-white">
          <strong>Pause System</strong>
        </div>
        <div class="card-body">
          <form method="POST" action="{{ url_for('pause_toggle') }}">
            <div class="card-body d-flex justify-content-between align-items-center">
              <!-- Label with icon -->
              <label class="form-check-label me-3" for="pauseSystem" style="cursor: pointer;">
                <!-- Pause icon SVG -->
                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor"
                  class="bi bi-pause-circle me-2" viewBox="0 0 16 16">
                  <path d="M6 5h1v6H6V5zm3 0h1v6H9V5z" />
                  <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zM8 1a7 7 0 1 1 0 14A7 7 0 0 1 8 1z" />
                </svg>
                Pause
              </label>

              <!-- Toggle switch -->
              <div class="form-check form-switch m-0">
                <input class="form-check-input" type="checkbox" id="pauseSystem" name="pause" value="on" {% if pause
                  %}checked{% endif %} onchange="this.form.submit()" />
              </div>
            </div>
          </form>
        </div>

      </div>
      </div>
      <!-- Settings Form -->
      <form method="POST" action="{{ url_for('select') }}">
        <div id="mainControls" class="container-fluid p-0" style="display: {{ 'none' if pause else 'block' }}">

          <!-- Playback Settings Card -->
          <div class="card mb-4 shadow-sm">
            <div class="card-header bg-primary text-white">
              <strong>Playback Settings</strong>
            </div>
            <div class="card-body">
              <p class="text-muted small mb-0">Enable video playback via motion trigger or endless loop. Select a
                playback mode: single, random, or fixed order. For random and fixed modes, specify how often the videos
                should switch.</p><br>

              <div class="card-body d-flex justify-content-between align-items-center">
                <!-- Label with icon -->
                <label class="form-check-label me-3" for="triggeredFlag" style="cursor: pointer;">
                  <!-- Trigger icon (you can change this to a bolt, bell, etc.) -->
                  <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor"
                    class="bi bi-camera-fill me-2" viewBox="0 0 16 16">
                    <path
                      d="M10.5 3h-5l-.5-1h-2A1.5 1.5 0 0 0 1.5 3v10A1.5 1.5 0 0 0 3 14.5h10A1.5 1.5 0 0 0 14.5 13V3A1.5 1.5 0 0 0 13 1.5h-2l-.5 1zM8 11.5a3.5 3.5 0 1 1 0-7 3.5 3.5 0 0 1 0 7z" />
                  </svg>
                  Triggered Mode
                </label>

                <!-- Toggle switch (part of form, but not auto-submitting) -->
                <div class="form-check form-switch m-0">
                  <input class="form-check-input" type="checkbox" id="triggeredFlag" name="triggered_flag" {% if
                    triggered_flag %}checked{% endif %}>
                </div>
              </div>
              <div class="mb-3">
                <div class="mb-3">
                  <label for="delay" class="form-label">Trigger Delay:</label>
                  <select class="form-select" id="delay" name="delay" {% if not triggered_flag %}disabled{% endif %}>
                    {% for i in range(0, 601, 30) %}
                    <option value="{{ i }}" {% if delay==i %}selected{% endif %}>
                      {% if i == 0 %}
                      No Delay
                      {% elif i < 60 %} {{ i }} sec {% elif i % 60==0 %} {{ i // 60 }} min {% else %} {{ i // 60 }} min
                        {{ i % 60 }} sec {% endif %} </option>
                        {% endfor %}
                  </select>
                </div>

              </div>


              <div class="mb-3">
                <label for="modeSelect" class="form-label">Playback Mode:</label>
                <select class="form-select" id="modeSelect" name="mode" onchange="updateModeUI()">
                  <option value="single" {% if playlist_mode=='single' %}selected{% endif %}>Single</option>
                  <option value="random" {% if video_count < 2 %}disabled{% endif %} {% if playlist_mode=='random'
                    %}selected{% endif %}>Random</option>
                  <option value="fixed" {% if video_count < 2 %}disabled{% endif %} {% if playlist_mode=='fixed'
                    %}selected{% endif %}>Fixed Order</option>
                </select>
              </div>

              <!-- Interval -->
              <div class="mb-3" id="intervalGroup" style="display:none;">
                <label for="interval" class="form-label">Change Video Every:</label>
                <select class="form-select" id="interval" name="interval">
                  {% for i in range(1, 61) %}
                  <option value="{{ i }}" {% if i==interval %}selected{% endif %}>
                    {{ i }} min
                  </option>
                  {% endfor %}
                </select>
              </div>

              <!-- Single Video -->
              <div class="mb-3" id="singleVideoSelectGroup" style="display:none;">
                <label for="video" class="form-label">Select Video:</label>
                <select class="form-select" id="video" name="video" onchange="updateVideoPreview()">
                  <option value="">-- Select a video --</option>
                  {% for video in videos %}
                  <option value="{{ video.filename }}" {% if video.filename==selected %}selected{% endif %}>{{
                    video.filename }}</option>
                  {% endfor %}
                </select>
              </div>
            </div>
          </div>

          <!-- Fixed Playlist -->
          <div id="fixedPlaylistGroup" class="card mb-4 shadow-sm" {% if playlist_mode !='fixed' %}style="display:none;"
            {% endif %}>
            <div class="card-header bg-primary text-white">
              <strong>Fixed Playlist Order</strong>
            </div>

            <div class="card-body">
              <p class="text-muted small mb-0">Drag to reorder the playlist below.</p><br>
              <ul id="fixedPlaylist" class="list-group mb-3" style="max-height: 300px; overflow-y: auto;">
                {% for video in fixed_order %}
                <li class="list-group-item" draggable="true">{{ video.filename }}</li>
                {% endfor %}
              </ul>
              <input type="hidden" name="fixed_order" id="fixedOrderInput" />
              <button type="submit" name="action" value="shuffle" class="btn btn-outline-secondary">Shuffle
                Playlist</button>
            </div>
          </div>

          <!-- Save Button -->
          <div class="text-end mb-4">
            <button type="submit" class="btn btn-success">Save Settings</button>
          </div>



        </div>
      </form>
    </section>

    <section id="schedule" class="section">
      <h3 class="fw-bold border-bottom pb-2 mb-4 text-primary">Schedule</h3>


      <div class="card mt-4 shadow-sm">
        <div class="card-header bg-primary text-white">
          <strong>Current Time</strong>
        </div>

        <div class="card-body">
          <div id="currentDateTime" class="mb-3 fw-bold"></div>

        </div>
      </div>



      <form id="scheduleForm" method="POST" action="{{ url_for('save_schedule') }}">
        <div class="card mt-4 shadow-sm">
          <div class="card-header bg-primary text-white">
            <strong>Playback Schedule</strong>
          </div>

          <div class="card-body">
            <p class="text-muted small mb-0">Enable specific days and set playback times. If a day is not enabled,
              playback will run all day by default.</p><br>
            <ul class="list-group mb-3">
              {% for day in ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'] %}
              <li class="list-group-item">
                <div
                  class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center gap-3">
                  <div class="form-check form-switch">
                    <input class="form-check-input schedule-toggle" type="checkbox" id="{{ day.lower() }}Enabled"
                      name="{{ day.lower() }}Enabled" {% if days and days[day].enabled %}checked{% endif %}>
                    <label class="form-check-label fw-semibold" for="{{ day.lower() }}Enabled">{{ day }}</label>
                  </div>
                  <div class="d-flex align-items-center gap-3 flex-wrap">
                    <div class="d-flex align-items-center">
                      <label for="{{ day.lower() }}Start" class="me-2 mb-0">Start</label>
                      <input type="time" class="form-control form-control-sm" id="{{ day.lower() }}Start"
                        name="{{ day.lower() }}Start" value="{{ days[day].start if days and days[day].start else '' }}"
                        {% if not days or not days[day].enabled %}disabled{% endif %}>
                    </div>
                    <div class="d-flex align-items-center">
                      <label for="{{ day.lower() }}End" class="me-2 mb-0">End</label>
                      <input type="time" class="form-control form-control-sm" id="{{ day.lower() }}End"
                        name="{{ day.lower() }}End" value="{{ days[day].end if days and days[day].end else '' }}" {% if
                        not days or not days[day].enabled %}disabled{% endif %}>
                    </div>
                  </div>
                </div>
              </li>
              {% endfor %}

            </ul>
          </div>
        </div>
        <br>
        <div class="text-end mb-4">
          <button type="submit" class="btn btn-success">Save Schedule</button>
        </div>
      </form>







    </section>

    <section id="upload" class="section">
      <h3 class="fw-bold border-bottom pb-2 mb-4 text-primary">Upload</h3>
      <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
          <strong>Upload Video</strong>
        </div>
        <div class="card-body">
          <p class="text-muted small mb-0">Upload new MP4 videos by dragging them here or selecting from your device.
          </p><br>

          <div class="text-center">
            <form id="uploadForm" method="POST" action="{{ url_for('upload') }}" enctype="multipart/form-data">
              <div id="dropArea" class="border border-3 border-secondary rounded p-5 bg-light">
                <p class="mb-2">Drag & drop an MP4 file here</p>
                <p class="small text-muted">or click to select</p>
                <input type="file" id="fileInput" name="file" accept=".mp4" hidden />
                <button type="button" class="btn btn-outline-secondary btn-sm"
                  onclick="document.getElementById('fileInput').click()">Choose File</button>
                <p id="fileName" class="mt-3 fw-bold text-success"></p>
              </div>
              <div class="mt-3">
                <button type="submit" class="btn btn-success" id="uploadBtn" disabled>Upload</button>
              </div>
            </form>
          </div>

        </div>

      </div>
    </section>


    <section id="manage" class="section">
      <h3 class="fw-bold border-bottom pb-2 mb-4 text-primary">Manage</h3>
      <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
          <strong>Manage Videos</strong>
        </div>
        <div class="card-body">

          <p class="text-muted small mb-0">Enable or disable videos in the playlist, or delete them from the system.</p>
          <br>



          <ul class="list-group">
            {% for video in manage_videos %}
            <li class="list-group-item d-flex justify-content-between align-items-center flex-column flex-sm-row">
              <form method="POST" action="{{ url_for('update_status') }}" class="mb-2 mb-sm-0">
                <input type="hidden" name="filename" value="{{ video.filename }}">
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" id="activeSwitch-{{ loop.index }}" name="active"
                    value="true" {% if video.active %}checked{% endif %} onchange="this.form.submit()" />
                  <label class="form-check-label" for="activeSwitch-{{ loop.index }}">{{ video.filename }}</label>
                </div>
              </form>
              <form method="POST" action="{{ url_for('delete', filename=video.filename) }}"
                onsubmit="return confirm('Delete {{ video.filename }}?');">
                <button type="submit" class="btn btn-danger btn-sm">Delete</button>
              </form>
            </li>
            {% else %}
            <li class="list-group-item">No videos found.</li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </section>

    <section id="logs" class="section">
      <h3 class="fw-bold border-bottom pb-2 mb-4 text-primary">Logs Section</h3>

      <div id="log" class="card shadow-sm">
        <div class="card-header bg-primary text-white">
          <strong>System Logs</strong>
        </div>
        <div class="card-body">
          <p class="text-muted small mb-0">Browse, download, or delete system logs for recent activity.</p><br>

          <ul class="list-group mb-3">
            {% for log in logs %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <div>
                <a href="#" class="view-log" data-filename="{{ log.name }}">{{ log.name }}</a>
                <small class="text-muted d-block">Size: {{ (log.size / 1024) | round(1) }} KB | Modified: {{ log.mtime
                  }}</small>
              </div>
              <form method="POST" action="{{ url_for('delete_log', filename=log.name) }}"
                onsubmit="return confirm('Delete log {{ log.name }}?');">
                <button type="submit" class="btn btn-danger btn-sm">Delete</button>
              </form>
            </li>
            {% else %}
            <li class="list-group-item">No logs found.</li>
            {% endfor %}
          </ul>
        </div>
      </div>




      <div id="log_details" class="card shadow-sm d-none">
        <div class="card-header bg-primary text-white">
          <strong>Log Detail</strong>
        </div>
        <div class="card-body">

          <button class="btn btn-secondary mb-3" id="backToList">Back</button>
          <pre id="logContent"></pre>


        </div>
      </div>
    </section>






    <section id="about" class="section">
      <h3 class="fw-bold border-bottom pb-2 mb-4 text-primary">About This Project</h3>

      <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
          <strong>About Us</strong>
        </div>
        <div class="card-body">
          <p class="text-muted small mb-0">If you like this project, make sure to subscribe to my YouTube channel.</p>
          <br>



          <!-- YouTube Subscribe -->
          <div class="mb-3 text-center">
            <a href="https://www.youtube.com/@LightsOnLanternLn" target="_blank" class="btn btn-danger">
              <i class="bi bi-youtube me-2"></i> Subscribe on YouTube
            </a>
          </div>


        </div>
      </div>

      <br>
      <div class="card shadow-sm mb-4">
        <div class="card-header bg-primary text-white">
          <strong>Parts List</strong>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-striped mb-0">
              <thead class="table-light">
                <tr>
                  <th scope="col">Item</th>
                  <th scope="col">Details</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Raspberry Pi</td>
                  <td>Model 3,4,5</td>
                </tr>
                <tr>
                  <td>MicroSD Card</td>
                  <td>With Raspberry Pi OS installed</td>
                </tr>
                <tr>
                  <td>5V Power Supply</td>
                  <td>Micro-USB, 2.5A or higher</td>
                </tr>
                <tr>
                  <td>PIR Sensor (5V)</td>
                  <td>HC-SR501 or similar (3-pin)</td>
                </tr>
                <tr>
                  <td>Jumper Wires (M to F)</td>
                  <td>3 wires for connection</td>
                </tr>
                <tr>
                  <td>HDMI Cable</td>
                  <td>Full-size HDMI</td>
                </tr>
                <tr>
                  <td>TV</td>
                  <td>With HDMI input</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <div class="card shadow-sm mb-4">
        <div class="card-header bg-primary text-white">
          <strong>Wiring Guide</strong>
        </div>
        <div class="card-body">
          <ul class="list-group list-group-flush">
            <li class="list-group-item">
              <strong>HDMI from Pi to TV:</strong><br>
              HDMI cable runs from Raspberry Pi’s HDMI port to the TV.
            </li>
            <li class="list-group-item">
              <strong>PIR Sensor Wiring:</strong>
              <ul class="mt-2">
                <li><strong>VCC (Red)</strong> → 5V pin on Pi</li>
                <li><strong>GND (Black)</strong> → GND pin on Pi</li>
                <li><strong>OUT (Yellow)</strong> → GPIO pin on Pi (assumed to be GPIO 4)</li>
              </ul>
            </li>
            <li class="list-group-item">
              <strong>5V Power Supply:</strong><br>
              Properly connected to the Pi’s micro-USB port.
            </li>
          </ul>
        </div>
      </div>


<p class="text-muted small">Version: {{ version }}</p>
    </section>





    <section id="Appearance" class="section">
      <h3 class="fw-bold border-bottom pb-2 mb-4 text-primary">Appearance Section</h3>

      <!-- Theme Selection Card -->
      <div class="card mb-4 shadow-sm">
        <div class="card-header bg-primary text-white">
          <strong>Theme</strong>
        </div>
        <div class="card-body">
          <p class="text-muted small mb-0">Customize your theme visual experience.</p><br>

          <div class="card-body d-flex justify-content-between align-items-center">
            <label class="form-check-label me-3" for="lightSwitch">
              <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor"
                class="bi bi-brightness-high" viewBox="0 0 16 16">
                <path
                  d="M8 11a3 3 0 1 1 0-6 3 3 0 0 1 0 6zm0 1a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z" />
              </svg>
              Light/Dark
            </label>
            <div class="form-check form-switch m-0">
              <input class="form-check-input" type="checkbox" id="lightSwitch" />
            </div>
          </div>

        </div>
      </div>

      <!-- Font Selection Card -->
      <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
          <strong>Font</strong>
        </div>
        <div class="card-body">
          <p class="text-muted small mb-0">Customize your font to create a personalized experience.</p><br>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="font" id="fontRoboto" value="'Roboto', sans-serif"
              checked>
            <label class="form-check-label" for="fontRoboto">Roboto</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="font" id="fontPoppins" value="'Poppins', sans-serif">
            <label class="form-check-label" for="fontPoppins">Poppins</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="font" id="fontInter" value="'Inter', sans-serif">
            <label class="form-check-label" for="fontInter">Inter</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="font" id="fontCreepster" value="'Creepster', cursive">
            <label class="form-check-label" for="fontCreepster">Creepster</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="font" id="fontButcherman" value="'Butcherman', cursive">
            <label class="form-check-label" for="fontButcherman">Butcherman</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="font" id="fontFredericka"
              value="'Fredericka the Great', cursive">
            <label class="form-check-label" for="fontFredericka">Fredericka the Great</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="font" id="fontNosifer" value="'Nosifer', cursive">
            <label class="form-check-label" for="fontNosifer">Nosifer</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="font" id="fontUnifrakturCook"
              value="'UnifrakturCook', cursive">
            <label class="form-check-label" for="fontUnifrakturCook">UnifrakturCook</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="font" id="fontUnifrakturMaguntia"
              value="'UnifrakturMaguntia', cursive">
            <label class="form-check-label" for="fontUnifrakturMaguntia">UnifrakturMaguntia</label>
          </div>
        </div>
      </div>

    </section>
  </main>


  <!-- Validation Error Modal -->
  <div class="modal fade" id="validationModal" tabindex="-1" aria-labelledby="validationModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content border-danger">
        <div class="modal-header bg-danger text-white">
          <h5 class="modal-title" id="validationModalLabel">Validation Error</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" id="validationModalBody">
          <!-- Message will be inserted here by JS -->
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

    <div id="loadingOverlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background-color:rgba(255,255,255,0.8); z-index:1050; justify-content:center; align-items:center;">
  <div class="spinner-border text-success" role="status" style="width: 3rem; height: 3rem;">
    <span class="visually-hidden">Uploading...</span>
  </div>
  <p class="mt-3 fw-bold">Uploading, please wait...</p>
</div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <script>
    function updateClock() {
      const now = new Date();
      const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
      const dayName = days[now.getDay()];

      // Format time in 12-hour format with seconds and AM/PM
      const timeString = now.toLocaleTimeString('en-US', {
        hour12: true,
        hour: 'numeric',
        minute: '2-digit',
        second: '2-digit'
      });

      document.getElementById('currentDateTime').textContent = `${dayName} ${timeString}`;
    }

    updateClock();
    setInterval(updateClock, 1000);


    document.addEventListener('DOMContentLoaded', () => {
      // --- File Upload Handling ---
      const dropArea = document.getElementById('dropArea');
      const fileInput = document.getElementById('fileInput');
      const fileName = document.getElementById('fileName');
      const uploadBtn = document.getElementById('uploadBtn');
      const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
      const triggerToggle = document.getElementById("triggeredFlag");
      const delayDropdown = document.getElementById("delay");

      // Initialize Bootstrap modal once
      const validationModal = new bootstrap.Modal(document.getElementById('validationModal'));
      const modalBody = document.getElementById('validationModalBody');



      const logList = document.getElementById('log');
      const logDetails = document.getElementById('log_details');
      const logContent = document.getElementById('logContent');
      const backBtn = document.getElementById('backToList');

      // When a log name is clicked
      document.querySelectorAll('.view-log').forEach(link => {
        link.addEventListener('click', async (e) => {
          e.preventDefault();
          const filename = e.target.dataset.filename;

          try {
            const response = await fetch(`/logs/raw/${filename}`);
            if (!response.ok) throw new Error("Log not found");
            const content = await response.text();
            logContent.textContent = content;

            // Switch view
            logList.classList.add('d-none');
            logDetails.classList.remove('d-none');
          } catch (err) {
            logContent.textContent = 'Error loading log: ' + err.message;
            logList.classList.add('d-none');
            logDetails.classList.remove('d-none');
          }
        });
      });

      // Back to log list
      backBtn.addEventListener('click', () => {
        logDetails.classList.add('d-none');
        logList.classList.remove('d-none');
        logContent.textContent = '';
      });



      function updateDelayState() {
        delayDropdown.disabled = !triggerToggle.checked;
      }

      triggerToggle.addEventListener("change", updateDelayState);

      // Initial state (in case it wasn't already set)
      updateDelayState();

      days.forEach(day => {
        const toggle = document.getElementById(`${day}Enabled`);
        const start = document.getElementById(`${day}Start`);
        const end = document.getElementById(`${day}End`);

        const updateInputs = () => {
          const enabled = toggle.checked;
          start.disabled = !enabled;
          end.disabled = !enabled;
        };

        // Validate times and show modal if invalid
        const validateTimes = () => {
          if (toggle.checked) {
            if (start.value && end.value) {
              if (start.value >= end.value) {
                // Show Bootstrap modal with message
                modalBody.textContent = `On ${day.charAt(0).toUpperCase() + day.slice(1)}, start time must be before end time.`;
                validationModal.show();

                // After modal closes, focus on start input
                document.getElementById('validationModal').addEventListener('hidden.bs.modal', () => {
                  start.focus();
                }, { once: true });

                return false;
              }
            }
          }
          return true;
        };

        // On page load
        updateInputs();

        // When toggle changes
        toggle.addEventListener('change', updateInputs);

        // Validate on form submit
        document.getElementById('scheduleForm').addEventListener('submit', e => {
          if (!validateTimes()) {
            e.preventDefault();
          }
        });

        // Optional: validate on input change for immediate feedback
        start.addEventListener('change', validateTimes);
        end.addEventListener('change', validateTimes);
      });



      document.getElementById('uploadForm').addEventListener('submit', () => {
        document.getElementById('loadingOverlay').style.display = 'flex';
      });

      ['dragenter', 'dragover'].forEach(eventName => {
        dropArea.addEventListener(eventName, e => {
          e.preventDefault();
          e.stopPropagation();
          dropArea.classList.add('border-success', 'bg-light');
        });
      });

      ['dragleave', 'drop'].forEach(eventName => {
        dropArea.addEventListener(eventName, e => {
          e.preventDefault();
          e.stopPropagation();
          dropArea.classList.remove('border-success', 'bg-light');
        });
      });

      dropArea.addEventListener('drop', e => {
        const files = e.dataTransfer.files;
        handleFile(files[0]);
      });

      fileInput.addEventListener('change', e => {
        if (e.target.files.length > 0) handleFile(e.target.files[0]);
      });


      function handleFile(file) {
        if (file.type === "video/mp4") {
          const dt = new DataTransfer();
          dt.items.add(file);
          fileInput.files = dt.files;
          fileName.textContent = `Selected: ${file.name}`;
          uploadBtn.disabled = false;
        } else {
          fileName.textContent = "Please upload a valid MP4 file.";
          uploadBtn.disabled = true;
        }
      }

      // --- Playlist Mode UI Updates ---
      const modeSelect = document.getElementById('modeSelect');
      const intervalGroup = document.getElementById('intervalGroup');
      const intervalSelect = document.getElementById('interval');
      const singleVideoGroup = document.getElementById('singleVideoSelectGroup');
      const fixedPlaylistGroup = document.getElementById('fixedPlaylistGroup');

      function updateModeUI() {
        const mode = modeSelect.value;

        if (mode === 'random' || mode === 'fixed') {
          intervalGroup.style.display = 'block';
          intervalSelect.disabled = false;
        } else {
          intervalGroup.style.display = 'none';
          intervalSelect.disabled = true;
        }

        singleVideoGroup.style.display = (mode === 'single') ? 'block' : 'none';
        fixedPlaylistGroup.style.display = (mode === 'fixed') ? 'block' : 'none';
      }
      modeSelect.addEventListener('change', updateModeUI);
      updateModeUI();

      // --- Video Preview Update ---
      const videoSelect = document.getElementById('video');
      const videoPreview = document.getElementById('videoPreview');

      function updateVideoPreview() {
        const video = videoSelect.value;
        if (video) {
          videoPreview.src = `/videos/${encodeURIComponent(video)}`;
          videoPreview.load();
        } else {
          videoPreview.pause();
          videoPreview.src = '';
        }
      }
      videoSelect.addEventListener('change', updateVideoPreview);
      updateVideoPreview();

      // --- Playlist Reordering with SortableJS ---
      const fixedPlaylist = document.getElementById('fixedPlaylist');
      const fixedOrderInput = document.getElementById('fixedOrderInput');

      const sortable = Sortable.create(fixedPlaylist, {
        animation: 150,
        onEnd: () => {
          const order = Array.from(fixedPlaylist.querySelectorAll('li')).map(li => li.textContent.trim());
          fixedOrderInput.value = order.join(',');
        }
      });

      // Initialize hidden input on load
      const initialOrder = Array.from(fixedPlaylist.querySelectorAll('li')).map(li => li.textContent.trim());
      fixedOrderInput.value = initialOrder.join(',');

      // --- Countdown Timer for Random/Fixed Modes ---
      {% if playlist_mode in ['random', 'fixed'] and time_remaining is not none and time_remaining > 0 %}
      let countdown = {{ time_remaining }};
    const countdownElement = document.getElementById('countdown');
    const countdownInterval = setInterval(() => {
      if (--countdown >= 0) {
        countdownElement.textContent = countdown;
      } else {
        clearInterval(countdownInterval);
        location.reload();
      }
    }, 1500);
    {% endif %}

    // --- Sidebar Tab Switching & State Persistence ---
    const navLinks = document.querySelectorAll('.sidebar .nav-link');
    const sections = document.querySelectorAll('.section');
    const sidebar = document.getElementById('sidebar');
    const content = document.getElementById('mainContent');
    const toggleButton = document.getElementById('toggleSidebar');
    const toggleIcon = toggleButton.querySelector('i');
    const alerts = document.querySelectorAll('.alert-dismissible');

    alerts.forEach(alert => {
      // Set a timer to remove the alert after 10 seconds (10000 ms)
      setTimeout(() => {
        // Use Bootstrap's alert dispose method to close it gracefully
        const bsAlert = bootstrap.Alert.getOrCreateInstance(alert);
        bsAlert.close();
      }, 10000);
    });

    // Function to activate a section by id
    function activateSection(sectionId) {
      navLinks.forEach(link => link.classList.toggle('active', link.getAttribute('data-section') === sectionId));
      sections.forEach(sec => sec.classList.toggle('active', sec.id === sectionId));
    }

    // Load saved active section or default to 'select'
    let savedSection = localStorage.getItem('activeSidebarSection') || 'select';
    // If savedSection is not found in DOM, fallback to first nav link's section
    if (![...sections].some(sec => sec.id === savedSection)) {
      savedSection = navLinks.length ? navLinks[0].getAttribute('data-section') : null;
    }
    if (savedSection) activateSection(savedSection);

    // Add click event to nav links
    navLinks.forEach(link => {
      link.addEventListener('click', () => {
        const selectedSection = link.getAttribute('data-section');
        localStorage.setItem('activeSidebarSection', selectedSection);
        activateSection(selectedSection);
      });
    });

    // --- Sidebar Toggle Button ---
    toggleButton.addEventListener('click', () => {
      sidebar.classList.toggle('collapsed');
      content.classList.toggle('collapsed');

      if (sidebar.classList.contains('collapsed')) {
        toggleIcon.classList.remove('bi-chevron-left');
        toggleIcon.classList.add('bi-chevron-right');
      } else {
        toggleIcon.classList.remove('bi-chevron-right');
        toggleIcon.classList.add('bi-chevron-left');
      }
    });






    // --- Theme & Font Persistence with Cookies and LocalStorage ---
    function getCookie(name) {
      const match = document.cookie.match(new RegExp('(^| )' + name + '=([^;]+)'));
      return match ? decodeURIComponent(match[2]) : null;
    }

    function setCookie(name, value, days = 30) {
      const expires = new Date(Date.now() + days * 86400 * 1000).toUTCString();
      document.cookie = `${name}=${encodeURIComponent(value)}; expires=${expires}; path=/`;
    }

    function setTheme(mode) {
      document.body.classList.toggle('dark-theme', mode === 'dark');
      localStorage.setItem('themeMode', mode);
      setCookie('themeMode', mode);
      updateIconTheme(mode);
    }

    function updateIconTheme(mode) {
      const icon = document.getElementById('themeIcon');
      if (!icon) return;
      icon.classList.remove('text-light', 'text-dark');
      icon.classList.add(mode === 'dark' ? 'text-light' : 'text-dark');
    }

    function setFont(font) {
      document.body.style.fontFamily = font;
      localStorage.setItem('fontFamily', font);
      setCookie('fontFamily', font);
    }

    // Load theme and font from storage/cookie or default
    const savedTheme = localStorage.getItem('themeMode') || getCookie('themeMode') || 'light';
    const savedFont = localStorage.getItem('fontFamily') || getCookie('fontFamily') || "'Roboto', sans-serif";

    setTheme(savedTheme);
    setFont(savedFont);
    updateIconTheme(savedTheme);

    // Setup theme switch toggle
    const lightSwitch = document.getElementById('lightSwitch');
    if (lightSwitch) {
      lightSwitch.checked = savedTheme === 'dark';
      lightSwitch.addEventListener('change', () => {
        setTheme(lightSwitch.checked ? 'dark' : 'light');
      });
    }

    // Setup font radio buttons
    const fontRadios = document.querySelectorAll('input[name="font"]');
    fontRadios.forEach(radio => {
      if (radio.value === savedFont) radio.checked = true;
      radio.addEventListener('change', () => {
        if (radio.checked) setFont(radio.value);
      });
    });
});
  </script>

</body>

</html>
